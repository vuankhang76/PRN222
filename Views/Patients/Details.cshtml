@model InfertilityApp.Models.Patient

@{
    ViewData["Title"] = "Chi tiết bệnh nhân";
}

<div class="space-y-6 bg-gray-50 min-h-screen">
    <!-- Header Section -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="bg-gradient-to-r from-green-600 to-emerald-600 text-white p-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                        <i class="bi bi-person-check text-4xl text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold mb-2">@(Model?.FullName ?? "N/A")</h1>
                        <div class="flex items-center space-x-4">
                            <span class="bg-white/20 px-4 py-2 rounded-full text-sm font-medium">
                                Mã BN: #@(Model?.Id ?? 0)
                            </span>
                            @if (Model?.Gender != null)
                            {
                                <span class="text-green-100">@Model.Gender</span>
                            }
                            @if (Model?.DateOfBirth != null)
                            {
                                <span class="text-green-100">@((int)((DateTime.Now - Model.DateOfBirth).TotalDays / 365.25)) tuổi</span>
                            }
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <a asp-action="Edit" asp-route-id="@Model?.Id" 
                       class="bg-white/20 backdrop-blur-sm text-white px-5 py-3 rounded-lg hover:bg-white/30 transition-all duration-300 flex items-center space-x-2">
                        <i class="bi bi-pencil"></i>
                        <span>Chỉnh sửa</span>
                    </a>
                    <a asp-action="Index" 
                       class="bg-white/10 backdrop-blur-sm text-white px-5 py-3 rounded-lg hover:bg-white/20 transition-all duration-300 flex items-center space-x-2 border border-white/20">
                        <i class="bi bi-arrow-left"></i>
                        <span>Quay lại</span>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Breadcrumb -->
        <div class="px-8 py-4 bg-gray-50 border-b border-gray-200">
            <nav class="flex items-center space-x-2 text-sm">
                <a asp-action="Index" class="text-green-600 hover:text-green-700 transition-colors duration-200 flex items-center space-x-1">
                    <i class="bi bi-house"></i>
                    <span>Danh sách bệnh nhân</span>
                </a>
                <i class="bi bi-chevron-right text-gray-400"></i>
                <span class="text-gray-600 font-medium">Chi tiết bệnh nhân</span>
                <i class="bi bi-chevron-right text-gray-400"></i>
                <span class="text-gray-800 font-semibold">@(Model?.FullName ?? "N/A")</span>
            </nav>
        </div>
    </div>

    @if (Model != null)
    {
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Personal Information -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Basic Info -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-b border-gray-200 p-6">
                        <h3 class="text-xl font-semibold text-gray-800 flex items-center space-x-3">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="bi bi-person text-green-600"></i>
                            </div>
                            <span>Thông tin cá nhân</span>
                        </h3>
                    </div>
                    
                    <div class="p-6 space-y-4">
                        <div class="text-center mb-6">
                            <div class="w-20 h-20 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="bi bi-person-circle text-4xl text-green-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800">@Model.FullName</h3>
                            <p class="text-gray-600">Bệnh nhân #@Model.Id</p>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <span class="font-medium text-gray-700">Ngày sinh:</span>
                                <span class="text-gray-600">@Model.DateOfBirth.ToString("dd/MM/yyyy")</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <span class="font-medium text-gray-700">Giới tính:</span>
                                <span class="text-gray-600">@(Model.Gender ?? "N/A")</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <span class="font-medium text-gray-700">Số điện thoại:</span>
                                <span class="text-gray-600">@(Model.PhoneNumber ?? "N/A")</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <span class="font-medium text-gray-700">Email:</span>
                                <span class="text-gray-600 break-all">@(Model.Email ?? "N/A")</span>
                            </div>
                            
                            @if (!string.IsNullOrEmpty(Model.Address))
                            {
                                <div class="flex items-start justify-between p-3 bg-gray-50 rounded-lg">
                                    <span class="font-medium text-gray-700">Địa chỉ:</span>
                                    <span class="text-gray-600 text-right">@Model.Address</span>
                                </div>
                            }
                            
                            @if (!string.IsNullOrEmpty(Model.Occupation))
                            {
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <span class="font-medium text-gray-700">Nghề nghiệp:</span>
                                    <span class="text-gray-600">@Model.Occupation</span>
                                </div>
                            }
                            
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <span class="font-medium text-gray-700">Ngày đăng ký:</span>
                                <span class="text-gray-600">@Model.RegistrationDate.ToString("dd/MM/yyyy")</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Medical History -->
                @if (!string.IsNullOrEmpty(Model.MedicalHistory) || !string.IsNullOrEmpty(Model.AllergiesInfo))
                {
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                        <div class="bg-gradient-to-r from-red-50 to-pink-50 border-b border-gray-200 p-6">
                            <h3 class="text-xl font-semibold text-gray-800 flex items-center space-x-3">
                                <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                    <i class="bi bi-heart-pulse text-red-600"></i>
                                </div>
                                <span>Tiền sử y tế</span>
                            </h3>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            @if (!string.IsNullOrEmpty(Model.MedicalHistory))
                            {
                                <div>
                                    <h4 class="font-medium text-gray-700 mb-2">Tiền sử bệnh:</h4>
                                    <div class="bg-red-50 p-4 rounded-lg border border-red-100">
                                        <p class="text-gray-700 whitespace-pre-line">@Model.MedicalHistory</p>
                                    </div>
                                </div>
                            }
                            
                            @if (!string.IsNullOrEmpty(Model.AllergiesInfo))
                            {
                                <div>
                                    <h4 class="font-medium text-gray-700 mb-2">Dị ứng:</h4>
                                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                                        <p class="text-gray-700 whitespace-pre-line">@Model.AllergiesInfo</p>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>

            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Partner Information -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200 p-6 flex justify-between items-center">
                        <h3 class="text-xl font-semibold text-gray-800 flex items-center space-x-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="bi bi-people text-blue-600"></i>
                            </div>
                            <span>Thông tin người phối ngẫu</span>
                        </h3>
                        @if (Model.Partner != null)
                        {
                            <a asp-controller="Partners" asp-action="Details" asp-route-id="@Model.Partner.Id" 
                               class="text-blue-600 hover:text-blue-700 transition-colors duration-200 flex items-center space-x-1">
                                <i class="bi bi-eye"></i>
                                <span>Chi tiết</span>
                            </a>
                        }
                    </div>
                    
                    <div class="p-6">
                        @if (Model.Partner != null)
                        {
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-100">
                                <div class="flex items-center space-x-4 mb-4">
                                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i class="bi bi-person-circle text-2xl text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h5 class="text-lg font-semibold text-gray-800">@(Model.Partner.FullName ?? "N/A")</h5>
                                        <p class="text-gray-600">
                                            @Model.Partner.DateOfBirth.ToString("dd/MM/yyyy") 
                                            (@((int)((DateTime.Now - Model.Partner.DateOfBirth).TotalDays / 365.25)) tuổi)
                                        </p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-700">Giới tính:</span>
                                        <span class="text-gray-600">@(Model.Partner.Gender ?? "N/A")</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="font-medium text-gray-700">Số điện thoại:</span>
                                        <span class="text-gray-600">@(Model.Partner.PhoneNumber ?? "N/A")</span>
                                    </div>
                                    @if (!string.IsNullOrEmpty(Model.Partner.Email))
                                    {
                                        <div class="flex justify-between md:col-span-2">
                                            <span class="font-medium text-gray-700">Email:</span>
                                            <span class="text-gray-600">@Model.Partner.Email</span>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-8">
                                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="bi bi-person-plus text-2xl text-gray-400"></i>
                                </div>
                                <p class="text-gray-600 mb-4">Chưa có thông tin người phối ngẫu</p>
                                <a asp-controller="Partners" asp-action="Create" asp-route-patientId="@Model.Id" 
                                   class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                                    Thêm người phối ngẫu
                                </a>
                            </div>
                        }
                    </div>
                </div>
                <!-- Treatments -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="bg-gradient-to-r from-purple-50 to-indigo-50 border-b border-gray-200 p-6 flex justify-between items-center">
                        <h3 class="text-xl font-semibold text-gray-800 flex items-center space-x-3">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="bi bi-clipboard2-pulse text-purple-600"></i>
                            </div>
                            <span>Quá trình điều trị</span>
                        </h3>
                        <div class="flex items-center space-x-3">
                            <a asp-controller="Treatments" asp-action="Index" asp-route-patientId="@Model.Id" 
                               class="text-purple-600 hover:text-purple-700 transition-colors duration-200 flex items-center space-x-1">
                                <i class="bi bi-eye"></i>
                                <span>Xem tất cả</span>
                            </a>
                            <a asp-controller="Treatments" asp-action="Create" asp-route-patientId="@Model.Id" 
                               class="bg-purple-600 text-white px-3 py-1 rounded-lg hover:bg-purple-700 transition-colors duration-200 flex items-center space-x-1">
                                <i class="bi bi-plus-circle"></i>
                                <span>Tạo mới</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        @if (Model.Treatments != null && Model.Treatments.Any())
                        {
                            <div class="space-y-4">
                                @foreach (var treatment in Model.Treatments.OrderByDescending(t => t.StartDate).Take(3))
                                {
                                    <div class="bg-gradient-to-r from-purple-50 to-indigo-50 p-4 rounded-lg border border-purple-100">
                                        <div class="flex items-center justify-between mb-2">
                                            <h4 class="font-semibold text-gray-800">@(treatment.TreatmentName ?? "N/A")</h4>
                                            @switch (treatment.Status)
                                            {
                                                case "In Progress":
                                                case "Active":
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                        <i class="bi bi-play-circle mr-1"></i>
                                                        Đang tiến hành
                                                    </span>
                                                    break;
                                                case "Completed":
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                        <i class="bi bi-check-circle mr-1"></i>
                                                        Hoàn thành
                                                    </span>
                                                    break;
                                                case "Cancelled":
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                        <i class="bi bi-x-circle mr-1"></i>
                                                        Đã hủy
                                                    </span>
                                                    break;
                                                default:
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                                        @(treatment.Status ?? "N/A")
                                                    </span>
                                                    break;
                                            }
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                            <div>
                                                <span class="font-medium text-gray-700">Loại:</span>
                                                <span class="text-gray-600 ml-1">@(treatment.TreatmentType ?? "N/A")</span>
                                            </div>
                                            <div>
                                                <span class="font-medium text-gray-700">Bác sĩ:</span>
                                                <span class="text-gray-600 ml-1">@(treatment.Doctor?.FullName ?? "N/A")</span>
                                            </div>
                                            <div>
                                                <span class="font-medium text-gray-700">Ngày bắt đầu:</span>
                                                <span class="text-gray-600 ml-1">@treatment.StartDate.ToString("dd/MM/yyyy")</span>
                                            </div>
                                        </div>
                                        <div class="mt-3 flex justify-end">
                                            <a asp-controller="Treatments" asp-action="Details" asp-route-id="@treatment.Id" 
                                               class="text-purple-600 hover:text-purple-800 font-medium text-sm flex items-center space-x-1">
                                                <span>Chi tiết</span>
                                                <i class="bi bi-arrow-right text-xs"></i>
                                            </a>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-8">
                                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="bi bi-clipboard-x text-2xl text-gray-400"></i>
                                </div>
                                <h4 class="text-lg font-medium text-gray-900 mb-2">Chưa có điều trị nào</h4>
                                <p class="text-gray-600 mb-4">Bắt đầu tạo kế hoạch điều trị cho bệnh nhân</p>
                                <a asp-controller="Treatments" asp-action="Create" asp-route-patientId="@Model.Id" 
                                   class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors duration-200">
                                    Tạo điều trị đầu tiên
                                </a>
                            </div>
                        }
                    </div>
                </div>

                <!-- Appointments -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="bg-gradient-to-r from-orange-50 to-yellow-50 border-b border-gray-200 p-6 flex justify-between items-center">
                        <h3 class="text-xl font-semibold text-gray-800 flex items-center space-x-3">
                            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                                <i class="bi bi-calendar-event text-orange-600"></i>
                            </div>
                            <span>Lịch hẹn</span>
                        </h3>
                        <div class="flex items-center space-x-3">
                            <a asp-controller="Appointments" asp-action="Index" asp-route-patientId="@Model.Id" 
                               class="text-orange-600 hover:text-orange-700 transition-colors duration-200 flex items-center space-x-1">
                                <i class="bi bi-eye"></i>
                                <span>Xem tất cả</span>
                            </a>
                            <a asp-controller="Appointments" asp-action="Create" asp-route-patientId="@Model.Id" 
                               class="bg-orange-600 text-white px-3 py-1 rounded-lg hover:bg-orange-700 transition-colors duration-200 flex items-center space-x-1">
                                <i class="bi bi-plus-circle"></i>
                                <span>Đặt lịch</span>
                            </a>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        @if (Model.Appointments != null && Model.Appointments.Any())
                        {
                            <div class="space-y-3">
                                @foreach (var appointment in Model.Appointments.OrderByDescending(a => a.AppointmentDate).Take(5))
                                {
                                    <div class="bg-gradient-to-r from-orange-50 to-yellow-50 p-4 rounded-lg border border-orange-100">
                                        <div class="flex items-center justify-between">
                                            <div class="flex-1">
                                                <div class="flex items-center space-x-4 mb-2">
                                                    <div class="flex items-center space-x-2">
                                                        <i class="bi bi-calendar3 text-orange-600"></i>
                                                        <span class="font-medium text-gray-800">@appointment.AppointmentDate.ToString("dd/MM/yyyy")</span>
                                                    </div>
                                                    <div class="flex items-center space-x-2">
                                                        <i class="bi bi-clock text-orange-600"></i>
                                                        <span class="text-gray-600">@appointment.AppointmentTime.ToString(@"hh\:mm")</span>
                                                    </div>
                                                </div>
                                                <div class="flex items-center space-x-4 text-sm">
                                                    <div>
                                                        <span class="font-medium text-gray-700">Bác sĩ:</span>
                                                        <span class="text-gray-600 ml-1">@(appointment.Doctor?.FullName ?? "N/A")</span>
                                                    </div>
                                                    @if (!string.IsNullOrEmpty(appointment.Purpose))
                                                    {
                                                        <div>
                                                            <span class="font-medium text-gray-700">Mục đích:</span>
                                                            <span class="text-gray-600 ml-1">@appointment.Purpose</span>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-3">
                                                @{
                                                    var statusClass = appointment.Status?.ToLower() switch
                                                    {
                                                        "scheduled" or "đã đặt" or "đã lên lịch" => "bg-blue-100 text-blue-800",
                                                        "completed" or "đã hoàn thành" => "bg-green-100 text-green-800",
                                                        "cancelled" or "đã hủy" => "bg-red-100 text-red-800",
                                                        "rescheduled" or "đổi lịch" => "bg-yellow-100 text-yellow-800",
                                                        _ => "bg-gray-100 text-gray-800"
                                                    };
                                                    var statusText = appointment.Status?.ToLower() switch
                                                    {
                                                        "scheduled" or "đã đặt" or "đã lên lịch" => "Đã lên lịch",
                                                        "completed" or "đã hoàn thành" => "Hoàn thành",
                                                        "cancelled" or "đã hủy" => "Đã hủy",
                                                        "rescheduled" or "đổi lịch" => "Đổi lịch",
                                                        _ => appointment.Status ?? "N/A"
                                                    };
                                                }
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium @statusClass">
                                                    @statusText
                                                </span>
                                                <a asp-controller="Appointments" asp-action="Details" asp-route-id="@appointment.Id" 
                                                   class="text-orange-600 hover:text-orange-800 font-medium text-sm">
                                                    Chi tiết
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-8">
                                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="bi bi-calendar-x text-2xl text-gray-400"></i>
                                </div>
                                <h4 class="text-lg font-medium text-gray-900 mb-2">Chưa có lịch hẹn nào</h4>
                                <p class="text-gray-600 mb-4">Đặt lịch hẹn đầu tiên cho bệnh nhân</p>
                                <a asp-controller="Appointments" asp-action="Create" asp-route-patientId="@Model.Id" 
                                   class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors duration-200">
                                    Đặt lịch hẹn đầu tiên
                                </a>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="text-center py-12">
            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="bi bi-exclamation-triangle text-3xl text-gray-400"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-800 mb-2">Không tìm thấy thông tin bệnh nhân</h3>
            <p class="text-gray-600 mb-6">Vui lòng kiểm tra lại hoặc liên hệ với quản trị viên</p>
            <a asp-action="Index" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors duration-200 inline-flex items-center space-x-2">
                <i class="bi bi-arrow-left"></i>
                <span>Quay lại danh sách</span>
            </a>
        </div>
    }
</div>